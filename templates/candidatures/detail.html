{% extends 'dashboard/index.html' %}

{% block title %}GRH Smart · {{ candidature.first_name }} {{ candidature.last_name }}{% endblock %}

{% block content %}
<div class="container mx-auto max-w-4xl space-y-6">

    <!-- HEADER BREADCRUMB -->
    <nav class="flex items-center gap-2 text-sm text-slate-400 mb-6">
      <a href="{% url 'candidatures:list' %}" class="hover:text-slate-300 transition">Candidatures</a>
      <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
      </svg>
      <span class="text-slate-300">{{ candidature.first_name }} {{ candidature.last_name }}</span>
    </nav>

    <!-- CARTE PRINCIPALE -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg">
      <div class="flex items-start justify-between mb-6">
        <div class="flex items-center gap-4">
          <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-violet-400 to-violet-300 grid place-items-center shadow-lg">
            <svg class="w-8 h-8 text-slate-900" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-slate-100">{{ candidature.first_name }} {{ candidature.last_name }}</h1>
            <p class="text-slate-400">{{ candidature.headline|default:"Candidat" }}</p>
            {% if candidature.email %}
              <p class="text-sm text-slate-500">{{ candidature.email }}</p>
            {% endif %}
          </div>
        </div>
        
        <!-- Statut Badge -->
        <div class="text-right">
          {% include 'candidatures/widgets/status_badge.html' with statut=candidature.status %}
        </div>
      </div>

      <!-- INFORMATIONS CLÉS -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <p class="text-xs text-slate-400 mb-1">Score global</p>
          <p class="text-3xl font-bold {% if candidature.fit_score_overall >= 80 %}text-emerald-400{% elif candidature.fit_score_overall >= 60 %}text-amber-400{% else %}text-rose-400{% endif %}">
            {{ candidature.fit_score_overall|default:0|floatformat:0 }}
            <span class="text-base text-slate-400 font-normal">/100</span>
          </p>
        </div>
        
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <p class="text-xs text-slate-400 mb-1">Expérience</p>
          <p class="text-lg font-semibold text-slate-200">{{ candidature.years_experience|default:0|floatformat:1 }} ans</p>
        </div>
        
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <p class="text-xs text-slate-400 mb-1">Date candidature</p>
          <p class="text-lg font-semibold text-slate-200">{{ candidature.created_at|date:"d M Y" }}</p>
          <p class="text-xs text-slate-400">{{ candidature.created_at|date:"H:i" }}</p>
        </div>
        
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <p class="text-xs text-slate-400 mb-1">Dernière MAJ</p>
          <p class="text-lg font-semibold text-slate-200">{{ candidature.updated_at|date:"d M Y" }}</p>
          <p class="text-xs text-slate-400">{{ candidature.updated_at|date:"H:i" }}</p>
        </div>
      </div>

      <!-- DÉTAILS DU PROFIL -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <!-- Compétences -->
        {% if candidature.skills_primary %}
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <h3 class="text-sm font-semibold text-slate-200 mb-3">Compétences principales</h3>
          <div class="flex flex-wrap gap-2">
            {% for skill in candidature.skills_primary %}
              <span class="px-3 py-1 text-sm rounded-lg bg-violet-950/50 text-violet-300 border border-violet-800">{{ skill }}</span>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Formation -->
        {% if candidature.education_highest %}
        <div class="rounded-xl border border-slate-800 bg-slate-900 p-4">
          <h3 class="text-sm font-semibold text-slate-200 mb-3">Formation</h3>
          <p class="text-slate-300">{{ candidature.education_highest }}</p>
        </div>
        {% endif %}
      </div>

      <!-- RÉSUMÉ DU CV -->
      {% if candidature.summary %}
      <div class="rounded-xl border border-slate-800 bg-slate-900 p-4 mb-6">
        <h3 class="text-sm font-semibold text-slate-200 mb-3">Résumé du profil</h3>
        <p class="text-slate-300 leading-relaxed">{{ candidature.summary|linebreaks }}</p>
      </div>
      {% endif %}

      <!-- SCORES DÉTAILLÉS -->
      {% if candidature.fit_scores %}
      <div class="rounded-xl border border-slate-800 bg-slate-900 p-4 mb-6">
        <h3 class="text-sm font-semibold text-slate-200 mb-3">Évaluation détaillée</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for criterium, score in candidature.fit_scores.items %}
          <div class="flex justify-between items-center">
            <span class="text-slate-400 capitalize">{{ criterium }}</span>
            <span class="font-semibold {% if score >= 80 %}text-emerald-400{% elif score >= 60 %}text-amber-400{% else %}text-rose-400{% endif %}">
              {{ score|floatformat:0 }}/100
            </span>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- ACTIONS -->
      <div class="flex flex-col sm:flex-row items-center gap-3 pt-6 border-t border-slate-800">
        <a href="{% url 'candidatures:list' %}" class="flex-1 sm:flex-none px-6 py-3 rounded-xl border border-slate-700 bg-slate-800 hover:bg-slate-700 transition text-center">
          ← Retour à la liste
        </a>
        
        {% if candidature.resume %}
          <a href="{{ candidature.resume }}" target="_blank" class="flex-1 sm:flex-none px-6 py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 transition text-white text-center">
            📄 Voir le CV
          </a>
        {% endif %}
      </div>
    </section>

</div>
{% endblock %}
