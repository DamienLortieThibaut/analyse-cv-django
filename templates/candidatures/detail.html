{% extends 'candidatures/base.html' %}

{% block candidature_title %}Détail de la candidature{% endblock %}

{% block candidature_content %}
<div class="flex justify-center">
    <div class="w-full max-w-4xl">
        {% if candidature %}
        <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg">
            <h2 class="text-center text-2xl font-bold text-slate-100 mb-4">
                <svg class="w-8 h-8 inline mb-1 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                Détail de la candidature
            </h2>
            
            <!-- Section Profil & Score -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div>
                    <h5 class="text-lg font-semibold text-slate-200 mb-2">Candidat identifié</h5>
                    <p class="text-violet-300 text-xl font-bold mb-2">{{ candidature.first_name }} {{ candidature.last_name }}</p>
                    <p class="text-slate-300 text-lg">{{ candidature.headline }}</p>
                    {% if candidature.summary %}
                    <p class="text-slate-400 text-sm mt-2">{{ candidature.summary }}</p>
                    {% endif %}
                    {% if candidature.email %}
                    <p class="text-slate-400 text-sm mt-1">{{ candidature.email }}</p>
                    {% endif %}
                    {% if candidature.phone %}
                    <p class="text-slate-400 text-sm">{{ candidature.phone }}</p>
                    {% endif %}
                </div>
                <div>
                    <h5 class="text-lg font-semibold text-slate-200 mb-2">Score global</h5>
                    {% if candidature.fit_score_overall %}
                    <div class="flex items-center mb-4">
                        <div class="flex-grow bg-slate-700 rounded-full h-6">
                            <div class="bg-emerald-500 h-6 rounded-full flex items-center justify-center text-white text-sm font-medium" 
                                 style="width: {{ candidature.fit_score_overall }}%">
                                {{ candidature.fit_score_overall }}%
                            </div>
                        </div>
                        <span class="ml-3 text-lg font-bold text-slate-100">{{ candidature.fit_score_overall }}/100</span>
                    </div>
                    
                    <!-- Scores détaillés -->
                    {% if candidature.fit_scores %}
                    <div class="space-y-2">
                        {% for key, value in candidature.fit_scores.items %}
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-slate-300 capitalize">{{ key|capfirst }}</span>
                            <div class="flex items-center ml-2">
                                <div class="w-16 bg-slate-700 rounded-full h-2 mr-2">
                                    <div class="bg-violet-400 h-2 rounded-full" style="width: {{ value }}%"></div>
                                </div>
                                <span class="text-slate-100 text-xs w-8">{{ value|floatformat:0 }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
            
            <!-- Section Expérience -->
            <div class="bg-slate-800/50 rounded-lg p-4 mb-6">
                <h6 class="text-lg font-semibold text-slate-200 mb-3">Expérience professionnelle</h6>
                <p class="text-emerald-300 text-lg font-medium mb-3">{{ candidature.years_experience }} années d'expérience professionnelle</p>
                {% if candidature.experiences %}
                <div class="space-y-3">
                    {% for experience in candidature.experiences %}
                    <div class="border-l-2 border-emerald-500 pl-4 py-2">
                        <div class="flex justify-between items-start mb-1">
                            <h8 class="font-medium text-slate-200">{{ experience.position }} • {{ experience.company }}</h8>
                            <span class="text-slate-400 text-xs">{{ experience.duration }}</span>
                        </div>
                        {% if experience.description %}
                        <p class="text-slate-300 text-sm">{{ experience.description }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Section Compétences -->
            <div class="bg-slate-800/50 rounded-lg p-4 mb-6">
                <h6 class="text-lg font-semibold text-slate-200 mb-3">Compétences</h6>
                <div class="grid md:grid-cols-2 gap-4">
                    {% if candidature.skills_primary %}
                    <div>
                        <h7 class="text-sm font-medium text-slate-300 mb-2">Compétences principales</h7>
                        <div class="flex flex-wrap gap-2">
                            {% for skill in candidature.skills_primary %}
                            <span class="bg-violet-600 text-white px-3 py-1 rounded-full text-xs">{{ skill }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                    {% if candidature.skills_secondary %}
                    <div>
                        <h7 class="text-sm font-medium text-slate-300 mb-2">Compétences secondaires</h7>
                        <div class="flex flex-wrap gap-2">
                            {% for skill in candidature.skills_secondary %}
                            <span class="bg-slate-600 text-slate-200 px-2 py-1 rounded-full text-xs">{{ skill }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Section Formation -->
            <div class="bg-slate-800/50 rounded-lg p-4 mb-6">
                <h6 class="text-lg font-semibold text-slate-200 mb-3">Formation</h6>
                <p class="text-blue-300 text-lg font-medium mb-3">{{ candidature.education_highest }}</p>
                {% if candidature.education %}
                <div class="space-y-3">
                    {% for edu in candidature.education %}
                    <div class="border-l-2 border-blue-500 pl-4 py-2">
                        <div class="flex justify-between items-start mb-1">
                            <h8 class="font-medium text-slate-200">{{ edu.degree }} • {{ edu.school }}</h8>
                            <span class="text-slate-400 text-xs">{{ edu.duration }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            <!-- Section Informations personnelles -->
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h7 class="text-sm font-medium text-slate-300 mb-2">Langues</h7>
                    <div>
                        {% if candidature.languages %}
                        {% for lang in candidature.languages %}
                        {% for code, level in lang.items %}
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-slate-300">{{ code|upper }}</span>
                            <span class="text-slate-400">{{ level }}</span>
                        </div>
                        {% endfor %}
                        {% endfor %}
                        {% else %}
                        <p class="text-slate-400 text-sm">Non spécifié</p>
                        {% endif %}
                    </div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h7 class="text-sm font-medium text-slate-300 mb-2">Localisation</h7>
                    <div>
                        {% if candidature.locations_preferred %}
                        {% for location in candidature.locations_preferred %}
                        <span class="bg-slate-700 text-slate-200 px-2 py-1 rounded text-xs block mb-1">{{ location }}</span>
                        {% endfor %}
                        {% else %}
                        <p class="text-slate-400 text-sm">Non spécifié</p>
                        {% endif %}
                    </div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h7 class="text-sm font-medium text-slate-300 mb-2">Centres d'intérêt</h7>
                    <div>
                        {% if candidature.interests %}
                        {% for interest in candidature.interests %}
                        <span class="text-slate-300 text-sm block mb-1">{{ interest }}</span>
                        {% endfor %}
                        {% else %}
                        <p class="text-slate-400 text-sm">Non spécifié</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Section Disponibilité & Salaire -->
            <div class="grid md:grid-cols-2 gap-4 mb-6">
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h7 class="text-sm font-medium text-slate-300 mb-2">Disponibilité</h7>
                    <p class="text-slate-300">
                        {% if candidature.availability_date %}
                        Disponible le {{ candidature.availability_date|date:"d/m/Y" }}
                        {% else %}
                        Disponibilité à définir
                        {% endif %}
                    </p>
                    <p class="text-slate-400 text-sm mt-1">Autorisation de travail: {{ candidature.get_work_authorization_display }}</p>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h7 class="text-sm font-medium text-slate-300 mb-2">Prétentions salariales</h7>
                    <p class="text-slate-300">
                        {% if candidature.salary_expectation_min or candidature.salary_expectation_max %}
                            {% if candidature.salary_expectation_min and candidature.salary_expectation_max %}
                                {{ candidature.salary_expectation_min }}€ - {{ candidature.salary_expectation_max }}€
                            {% elif candidature.salary_expectation_min %}
                                À partir de {{ candidature.salary_expectation_min }}€
                            {% elif candidature.salary_expectation_max %}
                                Jusqu'à {{ candidature.salary_expectation_max }}€
                            {% endif %}
                        {% else %}
                            Non spécifié
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- Section Statut -->
            <div class="bg-slate-800/50 rounded-lg p-4 mb-6">
                <h6 class="text-lg font-semibold text-slate-200 mb-3">Statut de la candidature</h6>
                <div class="flex flex-wrap gap-3 items-center">
                    <span class="bg-violet-600 text-white px-3 py-1 rounded-full text-sm">{{ candidature.get_status_display }}</span>
                    <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm">Priorité: {{ candidature.get_priority_display }}</span>
                    {% if candidature.status_reason %}
                    <div class="w-full mt-2">
                        <span class="text-sm text-slate-400">Raison: {{ candidature.status_reason }}</span>
                    </div>
                    {% endif %}
                </div>
                {% if candidature.analyzed_at %}
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-slate-400">Analysé le:</span>
                            <p class="text-slate-200">{{ candidature.analyzed_at|date:"d/m/Y H:i" }}</p>
                        </div>
                        {% if candidature.model_version %}
                        <div>
                            <span class="text-slate-400">Version modèle:</span>
                            <p class="text-slate-200">{{ candidature.model_version }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="text-center mt-6">
                <a href="{% url 'candidatures:list' %}" class="bg-violet-600 hover:bg-violet-700 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 shadow-lg inline-flex items-center mr-4">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Retour à la liste
                </a>
                <a href="{% url 'candidatures:upload' %}" class="bg-emerald-600 hover:bg-emerald-700 text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 shadow-lg inline-flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Nouvelle candidature
                </a>
            </div>
        </div>
        {% else %}
        <div class="p-6 bg-amber-900/20 border border-amber-700 text-amber-300 rounded-lg">
            <h4 class="text-xl font-semibold mb-2">Candidature non trouvée</h4>
            <p class="mb-4">La candidature demandée n'existe pas ou a été supprimée.</p>
            <a href="{% url 'candidatures:list' %}" class="bg-violet-600 hover:bg-violet-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 inline-flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
                </svg>
                Retour à la liste
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}